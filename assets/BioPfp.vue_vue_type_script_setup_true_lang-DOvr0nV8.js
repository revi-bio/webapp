import{O as b,r as f,A as p,d as S,l as D,c as _,a as P,o as F}from"./index-DCXiRpB3.js";const H=b("bios",()=>{const o=f([]),l=f(null),r=f(void 0);async function n(){try{const e=await p.get("bio",{});return o.value=e.data,e.data}catch(e){return console.error("Failed to fetch bios:",e),[]}}function d(){return o.value}function s(e){return o.value.find(t=>t.handle===e)}function i(){return o.value.length>0?o.value[0]:void 0}function c(e){const t=s(e);return t!=null&&t.avatar?`http://65.87.7.245/file/${t==null?void 0:t.avatar}`:null}async function m(e,t){try{const a={name:e,handle:t,views:0,widgets:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},u=await p.post("bio",a);return o.value.push(u.data),u.data}catch(a){return console.error("Failed to create bio:",a),null}}async function g(e){try{const t=await p.delete(`bio/${e}`,null);return n(),t.data}catch(t){return console.error("Failed to delete bio:",t),null}}async function v(e,t){try{const a=new FormData;a.append("file",e),console.log("File being uploaded:",e.name,e.size,e.type);const u=await p.patch(`bio/${t}/bioPfp`,a,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Upload response:",u),await n(),u.data}catch(a){throw console.error("Failed to upload profile picture. Error details:",a),a}}async function y(e){try{await p.delete(`bio/${e}/bioPfp`,null),await n()}catch(t){throw console.error("Failed to delete profile picture:",t),t}}function h(e){var t;l.value=e,r.value=(t=s(e))==null?void 0:t.name,localStorage.setItem("currentHandle",e),r.value&&localStorage.setItem("currentDisplayName",r.value)}function B(){if(!l.value){const e=localStorage.getItem("currentHandle"),t=localStorage.getItem("currentDisplayName");e&&(l.value=e,t&&(r.value=t))}return l.value}function w(){if(!r.value){const e=localStorage.getItem("currentDisplayName");e&&(r.value=e)}return r.value}return{bios:o,fetchBios:n,getBios:d,getBioByHandle:s,getFirstBio:i,getBioPfpUrl:c,createBio:m,deleteBio:g,uploadBioPfp:v,deleteBioPfp:y,getCurrentHandle:B,setCurrentHandle:h,getCurrentDisplayName:w}}),I=["src"],U=S({__name:"BioPfp",props:{bioHandle:{type:String,default:""}},setup(o){const l=o,r=H(),n=new URL("/webapp/assets/defPfp-DcALpk9F.png",import.meta.url).href;D(async()=>{r.bios.length===0&&await r.fetchBios()});const d=_(()=>r.getBioPfpUrl(l.bioHandle)||n),s=i=>{const c=i.target;c&&(c.src=n)};return(i,c)=>(F(),P("img",{src:d.value,key:d.value,alt:"Bio_profile_picture",class:"rounded-full object-cover",onError:s},null,40,I))}});export{U as _,H as u};
